# è‹±è¯­è¯­æ–™åº“ç³»ç»Ÿé…ç½®è¯´æ˜

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

æœ¬ç³»ç»Ÿé‡‡ç”¨nginx + Flaskæ¶æ„ï¼š
- **nginx**: ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¤„ç†é™æ€æ–‡ä»¶æœåŠ¡å’ŒAPIè½¬å‘
- **Flask**: ä½œä¸ºåç«¯åº”ç”¨æœåŠ¡å™¨ï¼Œæä¾›RESTful APIæ¥å£
- **Redis**: æ•°æ®ç¼“å­˜å’Œå­˜å‚¨
- **MySQL**: è¯­æ–™åº“æ•°æ®å­˜å‚¨

## ğŸ”§ é…ç½®æ–‡ä»¶è¯¦æƒ…

### 1. LaunchAgent å¼€æœºå¯åŠ¨é…ç½®

**æ–‡ä»¶ä½ç½®**: `/Users/learner/Library/LaunchAgents/com.user.english-corpus.plist`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.user.english-corpus</string>
    
    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>-c</string>
        <string>
            # å¯åŠ¨nginx
            /usr/local/bin/nginx
            
            # ç­‰å¾…nginxå¯åŠ¨
            sleep 3
            
            # å¯åŠ¨Flaskåº”ç”¨
            cd /Users/learner/Desktop/data/english
            source venv/bin/activate
            nohup python3 app.py > flask_app.log 2>&1 &
        </string>
    </array>
    
    <key>RunAtLoad</key>
    <true/>
    
    <key>KeepAlive</key>
    <false/>
    
    <key>StandardOutPath</key>
    <string>/Users/learner/Desktop/data/english/launchd.log</string>
    
    <key>StandardErrorPath</key>
    <string>/Users/learner/Desktop/data/english/launchd-error.log</string>
    
    <key>EnvironmentVariables</key>
    <dict>
        <key>PATH</key>
        <string>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</string>
    </dict>
    
    <key>WorkingDirectory</key>
    <string>/Users/learner/Desktop/data/english</string>
</dict>
</plist>
```

**ç®¡ç†å‘½ä»¤**:
```bash
# åŠ è½½é…ç½®
launchctl load ~/Library/LaunchAgents/com.user.english-corpus.plist

# å¸è½½é…ç½®
launchctl unload ~/Library/LaunchAgents/com.user.english-corpus.plist

# æŸ¥çœ‹çŠ¶æ€
launchctl list | grep english-corpus
```

### 2. nginx é…ç½®

**ä¸»é…ç½®æ–‡ä»¶**: `/usr/local/etc/nginx/nginx.conf`
**è™šæ‹Ÿä¸»æœºé…ç½®**: `/usr/local/etc/nginx/vhosts/mycorpus.conf`

```nginx
server {
    listen       80;
    server_name  www.mycorpus.com;

    access_log  /usr/local/var/log/nginx/mycorpus.access.log;
    error_log   /usr/local/var/log/nginx/mycorpus.error.log;

    # é™æ€æ–‡ä»¶æœåŠ¡
    location / {
        root   /Users/learner/Desktop/data/english;
        index  index.html index.htm;
        autoindex on;
    }

    # é™æ€èµ„æºç¼“å­˜é…ç½®
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        root   /Users/learner/Desktop/data/english;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # APIè¯·æ±‚ä»£ç†åˆ°Flaskåº”ç”¨
    location /api/ {
        proxy_pass http://127.0.0.1:5057;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**nginxç®¡ç†å‘½ä»¤**:
```bash
# å¯åŠ¨nginx
sudo nginx

# é‡æ–°åŠ è½½é…ç½®
sudo nginx -s reload

# åœæ­¢nginx
sudo nginx -s stop
```

### 3. Flask åº”ç”¨é…ç½®

**ä¸»æ–‡ä»¶**: `/Users/learner/Desktop/data/english/app.py`

ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š
- WebSocketé€šä¿¡ (SocketIO)
- Redisæ•°æ®ç¼“å­˜
- MySQLè¯­æ–™åº“æ•°æ®è®¿é—®
- RESTful APIæ¥å£

**å¯åŠ¨æ–¹å¼**:
```bash
cd /Users/learner/Desktop/data/english
source venv/bin/activate
python3 app.py
```

**ç”Ÿäº§ç¯å¢ƒå¯åŠ¨**:
```bash
cd /Users/learner/Desktop/data/english
source venv/bin/activate
nohup python3 app.py > flask_app.log 2>&1 &
```

## ğŸŒ ç½‘ç»œé…ç½®

### åŸŸåè§£æ
æœ¬åœ°hostsæ–‡ä»¶é…ç½®ï¼ˆ`/etc/hosts`ï¼‰:
```
127.0.0.1   www.mycorpus.com
```

### æœåŠ¡ç«¯å£
- **nginx**: 80 (HTTP)
- **Flask**: 5057 (åº”ç”¨ç«¯å£)
- **Redis**: 6379 (é»˜è®¤)
- **MySQL**: 3306 (é»˜è®¤)

## ğŸ” æƒé™é…ç½®

### ç›®å½•æƒé™è¦æ±‚
ä¸ºç¡®ä¿nginxæ­£å¸¸è®¿é—®ï¼Œéœ€è¦ä»¥ä¸‹ç›®å½•æƒé™ï¼š
```bash
# ç”¨æˆ·ç›®å½•æƒé™
sudo chmod o+rx /Users/learner/
sudo chmod o+rx /Users/learner/Desktop/

# é¡¹ç›®ç›®å½•æƒé™
sudo chmod -R o+rx /Users/learner/Desktop/data/english/
```

### æ–‡ä»¶æƒé™æ£€æŸ¥
```bash
# æ£€æŸ¥æ–‡ä»¶æ‰©å±•å±æ€§
ls -la@ /Users/learner/Desktop/data/english/index.html

# ç§»é™¤æ‰©å±•å±æ€§
xattr -c /Users/learner/Desktop/data/english/index.html
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **nginxè®¿é—®æ—¥å¿—**: `/usr/local/var/log/nginx/mycorpus.access.log`
- **nginxé”™è¯¯æ—¥å¿—**: `/usr/local/var/log/nginx/mycorpus.error.log`
- **Flåº”ç”¨æ—¥å¿—**: `/Users/learner/Desktop/data/english/flask_app.log`
- **å¯åŠ¨æœåŠ¡æ—¥å¿—**: `/Users/learner/Desktop/data/english/launchd.log`

### æœåŠ¡ç›‘æ§
```bash
# æ£€æŸ¥nginxçŠ¶æ€
ps aux | grep nginx | grep -v grep

# æ£€æŸ¥Flaskåº”ç”¨çŠ¶æ€
ps aux | grep "python.*app.py" | grep -v grep

# æµ‹è¯•æœåŠ¡è®¿é—®
curl -I http://www.mycorpus.com
curl -I http://www.mycorpus.com/api/get_saved_data
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### å…¨æ–°éƒ¨ç½²æ­¥éª¤
1. å®‰è£…nginx: `brew install nginx`
2. é…ç½®nginxè™šæ‹Ÿä¸»æœº
3. è®¾ç½®æœ¬åœ°åŸŸåè§£æ
4. é…ç½®ç›®å½•æƒé™
5. åˆ›å»ºLaunchAgentå¼€æœºå¯åŠ¨é…ç½®
6. åŠ è½½LaunchAgenté…ç½®

### æ—¥å¸¸ç»´æŠ¤å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
launchctl list | grep english-corpus

# é‡å¯æœåŠ¡
launchctl unload ~/Library/LaunchAgents/com.user.english-corpus.plist
launchctl load ~/Library/LaunchAgents/com.user.english-corpus.plist

# æŸ¥çœ‹æ—¥å¿—
tail -f /usr/local/var/log/nginx/mycorpus.error.log
tail -f /Users/learner/Desktop/data/english/flask_app.log
```

## âš ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **403 Forbiddené”™è¯¯**: æ£€æŸ¥ç›®å½•æƒé™å’Œæ–‡ä»¶æ‰©å±•å±æ€§
2. **502 Bad Gatewayé”™è¯¯**: æ£€æŸ¥Flaskåº”ç”¨æ˜¯å¦è¿è¡Œ
3. **è¿æ¥æ‹’ç»é”™è¯¯**: æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£é…ç½®

### æƒé™é—®é¢˜è§£å†³
```bash
# é€’å½’è®¾ç½®ç›®å½•æƒé™
sudo chmod -R o+rx /Users/learner/Desktop/data/english/

# æ£€æŸ¥å¹¶ä¿®å¤è·¯å¾„æƒé™
ls -ld /Users/learner/ /Users/learner/Desktop/ /Users/learner/Desktop/data/ /Users/learner/Desktop/data/english/
```

---
*æ–‡æ¡£æ›´æ–°æ—¶é—´: 2025-09-13*
*ç³»ç»Ÿç‰ˆæœ¬: nginx/1.29.1, Flask/3.1.2*
